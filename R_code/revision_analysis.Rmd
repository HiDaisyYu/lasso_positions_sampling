---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(lme4)
library(ggplot2)
library(plotrix)
library(visreg)
library(stringr)
library(tidyverse)
library(ggpubr)
library(gridExtra)
library(tidyverse)
library(tidymodels)
library(vip) 
library(plm)
```


```{r}
compare_to_naive_data<-read_tsv("/Users/noa/Workspace/lasso_positions_sampling_results/revision_files/comp_naive.tsv") %>% separate(dataset_id, "_supermatrices_",
                into = c("prefix", "last_value"), 
                remove = FALSE) %>% separate(last_value,"_",into = c("dataset_name", "suffix")) %>%  select(-c("prefix","suffix"))
jtt_data<-read_tsv("/Users/noa/Workspace/lasso_positions_sampling_results/revision_files/jtt.tsv") %>% separate(dataset_id, "_supermatrices_",
                into = c("prefix", "last_value"), 
                remove = FALSE) %>% separate(last_value,"_",into = c("dataset_name", "suffix")) %>%  select(-c("prefix","suffix"))
lg_data<-read_tsv("/Users/noa/Workspace/lasso_positions_sampling_results/revision_files/lg.tsv") %>% separate(dataset_id, "_supermatrices_",
                into = c("prefix", "last_value"), 
                remove = FALSE) %>% separate(last_value,"_",into = c("dataset_name", "suffix")) %>%  select(-c("prefix","suffix"))
gtr_data<-read_tsv("/Users/noa/Workspace/lasso_positions_sampling_results/revision_files/gtr.tsv") %>% separate(dataset_id, "_supermatrices_",
                into = c("prefix", "last_value"), 
                remove = FALSE) %>% separate(last_value,"_",into = c("dataset_name", "suffix")) %>%  select(-c("prefix","suffix"))
```

Compare to GTR, LG, JTT

```{r}
new_format_lasso_data %>% filter (actual_n_seq==30, actual_n_loci == 20000, actual_training_size ==4000) %>% group_by(actual_sample_pct, actual_training_size, actual_n_seq) %>% summarise (mean_r2 = mean(`lasso_test_R^2`), mean_spearman = mean(lasso_test_spearmanr)) 

jtt_data %>% group_by(actual_sample_pct, actual_training_size, actual_n_seq) %>% summarise (mean_r2 = mean(`lasso_test_R^2`), mean_spearman = mean(lasso_test_spearmanr)) 


lg_data %>% group_by(actual_sample_pct, actual_training_size, actual_n_seq) %>% summarise (mean_r2 = mean(`lasso_test_R^2`), mean_spearman = mean(lasso_test_spearmanr)) 


gtr_data %>% group_by(actual_sample_pct, actual_training_size, actual_n_seq) %>% summarise (mean_r2 = mean(`lasso_test_R^2`), mean_spearman = mean(lasso_test_spearmanr)) 


lasso_data_anova<- new_format_lasso_data %>% filter (actual_n_seq==30, actual_n_loci == 20000, actual_training_size ==4000) %>% select (dataset_name,actual_sample_pct, `lasso_test_R^2`)  %>% mutate (model = "WAG", accuracy =`lasso_test_R^2` ) %>% arrange(dataset_name,actual_sample_pct)
jtt_data_anova<- jtt_data %>% filter (actual_n_seq==30, actual_n_loci == 20000, actual_training_size ==4000) %>% select (dataset_name,actual_sample_pct, `lasso_test_R^2`)   %>% mutate (model = "JTT", accuracy = `lasso_test_R^2`) %>% arrange(dataset_name,actual_sample_pct)
lg_data_anova<- lg_data %>% filter (actual_n_seq==30, actual_n_loci == 20000, actual_training_size ==4000) %>% select (dataset_name,actual_sample_pct, `lasso_test_R^2`)  %>% mutate (model = "LG", accuracy =`lasso_test_R^2` ) %>% arrange(dataset_name,actual_sample_pct)
gtr_data_anova<- gtr_data %>% filter (actual_n_seq==30, actual_n_loci == 20000, actual_training_size ==4000) %>% select (dataset_name,actual_sample_pct, `lasso_test_R^2`)  %>% mutate (model = "GTR", accuracy =`lasso_test_R^2` ) %>% arrange(dataset_name,actual_sample_pct)

all_models_data<-rbind(lasso_data_anova,jtt_data_anova,lg_data_anova)
gtr_vs_wag_data<-rbind(lasso_data_anova,gtr_data_anova)
gtr_vs_all_data<-rbind(lasso_data_anova,gtr_data_anova,jtt_data_anova,lg_data_anova)




t.test(lasso_data_anova$accuracy,jtt_data_anova$accuracy, paired = TRUE)
t.test(lasso_data_anova$accuracy,lg_data_anova$accuracy, paired = TRUE)

lin<- lm(log(accuracy/(1-accuracy))~actual_sample_pct+as.factor(model)+dataset_name, data = all_models_data)
lin2<- lm(log(accuracy/(1-accuracy))~actual_sample_pct+as.factor(model), data = gtr_vs_wag_data)

library(nlme)
library(rsq)

gtr_vs_all_data$model = as.factor(gtr_vs_all_data$model)
gtr_vs_all_data <- within(gtr_vs_all_data, model <- relevel(model, ref = "WAG"))


lme2 = lme(log(accuracy/(1-accuracy)) ~ actual_sample_pct+as.factor(model), random = ~ 1 | dataset_name, data =gtr_vs_all_data)

print(rsq(lme2))
plot.lme((lme2))
 
```
Compare to naive 


```{r}


comp_data<-compare_to_naive_data %>% select (dataset_name,curr_msa_version_folder,actual_n_seq, actual_n_loci, actual_sample_pct, actual_training_size,`lasso_test_R^2`, `lasso_test_R^2_random`,`lasso_test_R^2_high_rate`, lasso_test_spearmanr, lasso_test_spearmanr_random, lasso_test_spearmanr_high_rate) %>% mutate (lasso_vs_random =`lasso_test_R^2`-`lasso_test_R^2_random`, lasso_vs_high_rate  =  `lasso_test_R^2`-`lasso_test_R^2_high_rate`, rel_lasso_vs_random =(`lasso_test_R^2`-`lasso_test_R^2_random`)/(1-`lasso_test_R^2`),rel_lasso_vs_high_rate =  (`lasso_test_R^2`-`lasso_test_R^2_high_rate`)/(1-`lasso_test_R^2`))                                                                                                  

comp_data

comp_data %>% group_by(actual_sample_pct,actual_training_size, actual_n_loci, actual_n_seq) %>% summarize (mean_random = mean(lasso_vs_random), mean_high_rate = mean(lasso_vs_high_rate))

```

```{r}
lm(lasso_vs_random ~ actual_sample_pct ,data = comp_data)

comp_data %>% ggplot(aes(x=actual_sample_pct, y =lasso_vs_random, color = dataset_name )) + geom_point()
```


Partition analysis
```{r}

test_no_par<-read_tsv("/Users/noa/Workspace/lasso_positions_sampling_results/revision_files/test_no_partition.tsv") %>% separate(dataset_id, "_supermatrices_",
                into = c("prefix", "last_value"), 
                remove = FALSE) %>% separate(last_value,"_",into = c("dataset_name", "suffix")) %>%  select(-c("prefix","suffix"))
test_par<- read_tsv("/Users/noa/Workspace/lasso_positions_sampling_results/revision_files/test_partition.tsv") %>% separate(dataset_id, "_supermatrices_",
                into = c("prefix", "last_value"), 
                remove = FALSE) %>% separate(last_value,"_",into = c("dataset_name", "suffix")) %>%  select(-c("prefix","suffix"))
```

```{r}
test_par %>% select (expected_partition_counts,observed_partition_counts)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

