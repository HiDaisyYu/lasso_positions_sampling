---
title: "R Notebook"
output: html_notebook
---


```{r}
library(lme4)
library(ggplot2)
library(plotrix)
library(visreg)
library(stringr)
library(tidyverse)
library(ggpubr)
library(gridExtra)
library(tidyverse)
library(tidymodels)
library(vip) 
library(plm)
```


```{r}
new_format_lasso_data<- read_csv("/Users/noa/Workspace/lasso_positions_sampling_results/lasso_new_spr.csv")
new_format_lasso_data<- new_format_lasso_data %>% 
           separate(dataset_id, "_supermatrices_",
                into = c("prefix", "last_value"), 
                remove = FALSE) %>% separate(last_value,"_",into = c("dataset_name", "suffix")) %>%  select(-c("prefix","suffix"))
```

```{r}
new_format_lasso_data %>% distinct (dataset_id, job_ind,MSA_original_n_seq, actual_n_seq)
```

```{r}
new_format_lasso_data %>% select (dataset_id,actual_n_seq,actual_n_loci,actual_sample_pct,actual_training_size, actual_n_loci, `lasso_test_R^2`,) 
```



```{r}
unexplained_variance_data<- new_format_lasso_data %>% mutate (unexplained_var =1-`lasso_test_R^2` )

unexplained_variance_data %>% select (dataset_id,actual_n_seq,actual_n_loci,actual_sample_pct,actual_training_size, actual_n_loci, unexplained_var)



unexplained_variance_data  %>% filter(job_ind==0) %>% group_by(job_ind,actual_n_seq,actual_training_size, actual_sample_pct, actual_n_loci) %>%
  ggplot(aes(x=actual_sample_pct,y=unexplained_var, group = as.factor(actual_training_size), color = as.factor(actual_training_size))) +geom_line(size=1) + geom_point(size=2) + scale_x_continuous(labels = scales::percent,breaks = c(0.01,0.025,0.05,0.1)) +labs(color="Training size",x="Sample percentage",y="Unexplained variance (%)", title="Percentage of unexplained variance on test sets") + scale_y_continuous(labels = scales::percent, expand = c(0,0)) +theme_classic()+# coord_cartesian(ylim = c(0, NA))+
  facet_grid(rows = vars(actual_n_seq), cols = vars(actual_n_loci)) + theme(axis.text.x = element_text(angle = 60, vjust = 0.9, hjust=1))


unexplained_variance_data  %>% filter(job_ind==3) %>% group_by(job_ind,actual_n_seq,actual_training_size, actual_sample_pct, actual_n_loci) %>%
  ggplot(aes(x=actual_sample_pct,y=unexplained_var, group = as.factor(actual_training_size), color = as.factor(actual_training_size))) +geom_line(size=1) + geom_point(size=2) + scale_x_continuous(labels = scales::percent,breaks = c(0.01,0.025,0.05,0.1)) +labs(color="Training size",x="Sample percentage",y="Unexplained variance (%)", title="Percentage of unexplained variance on test sets") + scale_y_continuous(labels = scales::percent, expand = c(0,0)) +theme_classic()+# coord_cartesian(ylim = c(0, NA))+
  facet_grid(rows = vars(actual_n_seq), cols = vars(actual_n_loci)) + theme(axis.text.x = element_text(angle = 60, vjust = 0.9, hjust=1))


unexplained_variance_data  %>% filter(job_ind==7) %>% group_by(job_ind,actual_n_seq,actual_training_size, actual_sample_pct, actual_n_loci) %>%
  ggplot(aes(x=actual_sample_pct,y=unexplained_var, group = as.factor(actual_training_size), color = as.factor(actual_training_size))) +geom_line(size=1) + geom_point(size=2) + scale_x_continuous(labels = scales::percent,breaks = c(0.01,0.025,0.05,0.1)) +labs(color="Training size",x="Sample percentage",y="Unexplained variance (%)", title="Percentage of unexplained variance on test sets") + scale_y_continuous(labels = scales::percent, expand = c(0,0)) +theme_classic()+# coord_cartesian(ylim = c(0, NA))+
  facet_grid(rows = vars(actual_n_seq), cols = vars(actual_n_loci)) + theme(axis.text.x = element_text(angle = 60, vjust = 0.9, hjust=1))

unexplained_variance_data  %>% filter(job_ind==5) %>% group_by(job_ind,actual_n_seq,actual_training_size, actual_sample_pct, actual_n_loci) %>%
  ggplot(aes(x=actual_sample_pct,y=unexplained_var, group = as.factor(actual_training_size), color = as.factor(actual_training_size))) +geom_line(size=1) + geom_point(size=2) + scale_x_continuous(labels = scales::percent,breaks = c(0.01,0.025,0.05,0.1)) +labs(color="Training size",x="Sample percentage",y="Unexplained variance (%)", title="Percentage of unexplained variance on test sets") + scale_y_continuous(labels = scales::percent, expand = c(0,0)) +theme_classic()+# coord_cartesian(ylim = c(0, NA))+
  facet_grid(rows = vars(actual_n_seq), cols = vars(actual_n_loci)) + theme(axis.text.x = element_text(angle = 60, vjust = 0.9, hjust=1))


unexplained_variance_data  %>% filter(job_ind==1) %>% group_by(job_ind,actual_n_seq,actual_training_size, actual_sample_pct, actual_n_loci) %>%
  ggplot(aes(x=actual_sample_pct,y=unexplained_var, group = as.factor(actual_training_size), color = as.factor(actual_training_size))) +geom_line(size=1) + geom_point(size=2) + scale_x_continuous(labels = scales::percent,breaks = c(0.01,0.025,0.05,0.1)) +labs(color="Training size",x="Sample percentage",y="Unexplained variance (%)", title="Percentage of unexplained variance on test sets") + scale_y_continuous(labels = scales::percent, expand = c(0,0)) +theme_classic()+# coord_cartesian(ylim = c(0, NA))+
  facet_grid(rows = vars(actual_n_seq), cols = vars(actual_n_loci)) + theme(axis.text.x = element_text(angle = 60, vjust = 0.9, hjust=1))


unexplained_variance_data  %>% filter(job_ind==9) %>% group_by(job_ind,actual_n_seq,actual_training_size, actual_sample_pct, actual_n_loci) %>%
  ggplot(aes(x=actual_sample_pct,y=unexplained_var, group = as.factor(actual_training_size), color = as.factor(actual_training_size))) +geom_line(size=1) + geom_point(size=2) + scale_x_continuous(labels = scales::percent,breaks = c(0.01,0.025,0.05,0.1)) +labs(color="Training size",x="Sample percentage",y="Unexplained variance (%)", title="Percentage of unexplained variance on test sets") + scale_y_continuous(labels = scales::percent, expand = c(0,0)) +theme_classic()+# coord_cartesian(ylim = c(0, NA))+
  facet_grid(rows = vars(actual_n_seq), cols = vars(actual_n_loci)) + theme(axis.text.x = element_text(angle = 60, vjust = 0.9, hjust=1))



```


```{r}
new_format_lasso_data %>% mutate(actual_training_evaluation_time = full_size_training_evaluation_time*(actual_training_size/4000)) %>% distinct (dataset_name,actual_n_loci, actual_training_size,actual_training_evaluation_time, lasso_running_time,full_training_random_trees_generation_time)   %>% mutate(dims = actual_training_size*actual_n_loci) %>% ggplot(
       aes(x = actual_training_evaluation_time /3600,#dims,#full_training_random_trees_generation_time, 
           y = lasso_running_time/3600
           ))+
  #viridis::scale_color_viridis(discrete = TRUE)+
  geom_point(size     = 3,
             alpha    = .8, 
             position = "jitter") + labs(color="Dataset name",x="dims",y="Lasso running-time") +theme_classic()

```

```{r}

```


